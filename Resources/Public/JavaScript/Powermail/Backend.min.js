function PowermailBackend(r){"use strict";this.initialize=function(){e(),i(),t(),n(),o(),l(),a(),s(),c(),d(),f(),u(),m(),p()};var e=function(){r('*[data-action="openPowermailDetails"]').click(function(){var e=r(this),i=(e.closest("tr").find(".icon:first").toggle(),e.closest("tr").find(".openPowermailDetailsIcons .icon:last"));i.is(":visible")?i.css("display","none"):i.css("display","inline-block"),e.closest("tr").next().toggleClass("powermail_listbe_details_closed").find(".powermail_listbe_details_container").slideToggle()})},i=function(){r(document).on("click",".unhideMail, .hideMail",function(){var e=r(this),i=e.closest("td").find(".container_module_uri").val(),t=e.closest("td").find(".container_uid").val(),n=e.closest("td").find(".container_table").val(),e=h(e.closest("tr"));v(n,t,e,i)})},t=function(){r(document).on("click",'*[data-action="deleteMail"]',function(){var e=r(this),i=e.closest("td").find(".container_module_uri").val(),t=e.closest("td").find(".container_uid").val(),n=e.closest("td").find(".container_table").val(),o=e.closest("td").find(".container_label_delete_confirmation").val();confirm(o)&&(_(e.closest("tr")),w(n,t,i))})};let n=function(){let e=document.querySelectorAll(".powermail_list .pagination a");e.forEach(function(e){e.addEventListener("click",function(e){e.preventDefault();let i=e.target.getAttribute("href").split("&"),t=0;for(let e=0;e<i.length;e++)-1!==i[e].indexOf("currentPage")&&(t=parseInt(i[e].split("=")[1]));if(0<t){const n=document.querySelector("#powermail_module_search"),o=document.createElement("input");o.setAttribute("type","text"),o.setAttribute("name","tx_powermail_web_powermailm1[currentPage]"),o.setAttribute("value",t.toString()),n.appendChild(o),n.submit()}})})};var o=function(){r("a.sorting").click(function(e){e.preventDefault();for(var i,t=r(this).prop("href").split("&"),n="",o=0;o<t.length;o++)-1!==t[o].indexOf("sorting")&&(n=t[o]);""!==n&&((e=n.split("="))[0]=e[0].replace("%40","@"),(i=r('.extended_export_sorting_container[name="'+decodeURI(e[0])+'"]')).length&&i.remove(),i='<input type="hidden" name="'+e[0]+'" value="'+e[1]+'" />',(e=r("#powermail_module_search")).append(decodeURI(i)),e.submit())})},l=function(){r(".addPowermailSelection").click(function(){b(r(this)),g()})},a=function(){r(".addPowermailSelectionAll").click(function(){r(".addPowermailSelection").each(function(){b(r(this))}),g()})},s=function(){r(".powermailSelectionDelete").click(function(){C()})},c=function(){r(".powermailSelectionHide").click(function(){y(r)})},d=function(){r("#extended_search input, #extended_search select").not('*[type="submit"]').each(function(){""!==r(this).val()&&r("#extended_search").addClass("in")})},f=function(){r(".export_icon_xls, .export_icon_csv").click(function(){r(this).hasClass("export_icon_csv")&&r("#forwardToAction").val("exportCsv"),r(this).hasClass("export_icon_xls")&&r("#forwardToAction").val("exportXls"),r(this).closest("form").submit()}),r('*[data-action="searchall_submit"]').click(function(){r("#forwardToAction").val("list")}),r(".extended_export_title").click(function(){var e=r(this);e.hasClass("powermail-close")?(e.removeClass("powermail-close").addClass("powermail-open").children("span").removeClass("t3-icon-move-down").addClass("t3-icon-move-up"),e.next().slideDown("",function(){e.next().children("div").children("div").fadeTo("slow",1)})):(e.removeClass("powermail-open").addClass("powermail-close").children("span").removeClass("t3-icon-move-up").addClass("t3-icon-move-down"),e.next().children("div").children("div").fadeTo("slow",0,function(){e.next().slideUp()}))}),r(function(){r(".extended_export_field, .extended_export_field_container").sortable({connectWith:".connected",update:function(e,i){var t;"export_field_selection"===r(this).prop("id")&&(t=r(this).sortable("toArray").toString(),r("#export_fields").val(t))}}).disableSelection()})},u=function(){r(".openHiddenTable").click(function(){var e=r(this).closest("tr");e.find(".dots").toggle(),e.find(".hiddenConverterTable").toggle()})},m=function(){r(".powermail_listbe_details_dd.powermail_listbe_details_type_password").html("********")},p=function(){var e=r(".powermail_reporting_form_fields_table");e.find("tr:even").addClass("even"),e.find("tr:first").removeClass("even"),e.find("tr").hide(),e.find("tr:first").show(),e.find("th").click(function(){var e=r(this);e.hasClass("powermail-close")?e.removeClass("powermail-close").addClass("powermail-open"):e.removeClass("powermail-open").addClass("powermail-close"),e.parent().siblings().slideToggle("fast")}),r('*[data-flot-active="1"]').each(function(){for(var e=r(this),i=[],t=P(e.data("flot-data-values"),","),n=P(e.data("flot-data-labels"),","),o=P(e.data("flot-data-colors"),","),l=0;l<t.length;l++){var a={data:t[l],label:n[l],color:o[l]};i.push(a)}r.plot(e,i,{series:{pie:{show:!0,innerRadius:.5,radius:1,opacity:.3,color:"#FF0000",label:{show:!0,radius:1,formatter:j,background:{opacity:.8}},combine:{color:"#999",threshold:.1}}},grid:{hoverable:!0,clickable:!0}}),e.bind("plothover",function(e,i,t){var n;t&&(n=parseFloat(t.series.percent).toFixed(2),r("#hover").html("<span style='font-weight:bold; color:"+t.series.color+"'>"+t.series.label+" ("+n+"%)</span>"))}),e.bind("plotclick",function(e,i,t){var n;t&&(n=parseFloat(t.series.percent).toFixed(2),alert(t.series.label+": "+n+"%"))})})},h=function(e){var i=e.find(".visibilityButton"),t=0;return i.hasClass("unhideMail")?(i.removeClass("unhideMail").removeClass("fa-toggle-off").addClass("hideMail").addClass("fa-toggle-on"),e.find(".powermailRecordIcon").children(":first").removeClass("hide"),e.find(".powermailRecordIcon").children(":last").addClass("hide")):(i.removeClass("hideMail").removeClass("fa-toggle-on").addClass("unhideMail").addClass("fa-toggle-off"),e.find(".powermailRecordIcon").children().last().removeClass("hide"),e.find(".powermailRecordIcon").children().first().addClass("hide"),t=1),t},v=function(e,i,t,n){r.ajax({url:n+"&data["+e+"]["+i+"][hidden]="+t})},w=function(e,i,t){r.ajax({url:t+"&cmd["+e+"]["+i+"][delete]=1"})},_=function(e){e.fadeOut("slow",function(){e.next().remove(),e.remove()})},b=function(e){(e.hasClass("fa")?e.toggleClass("fa-plus").toggleClass("fa-minus"):e.toggleClass("t3-icon-view-table-expand").toggleClass("t3-icon-view-table-collapse")).closest("tr").toggleClass("selectLine")},g=function(){var e=r(".selectLine").length;r(".selectedLineMessage_numbers").html(e),0<e?r(".selectedLineMessage").show():r(".selectedLineMessage").hide()},C=function(){r(".selectLine").each(function(){var e=r(this),i=e.children(":last"),t=i.find(".container_module_uri").val(),n=i.find(".container_uid").val(),i=i.find(".container_table").val();w(i,n,t),_(e),x(e)}),g()},x=function(e){e=e.find(".addPowermailSelection");b(e)},y=function(){r(".selectLine").each(function(){var e=r(this),i=e.children(":last"),t=i.find(".container_module_uri").val(),n=i.find(".container_uid").val(),i=i.find(".container_table").val();v(i,n,h(e),t),x(e)}),g()},P=function(e,i){i=-1!==e.toString().indexOf(i)?e.split(i):[e];return i},j=function(e,i){return'<div class="flotLabel">'+e+"<br/>"+Math.round(i.percent)+"%</div>"};window.PowermailBackend=PowermailBackend}requirejs.config({map:{"*":{"jquery.flot.min":"TYPO3/CMS/Powermail/Libraries/jquery.flot.min"}},shim:{"TYPO3/CMS/Powermail/Libraries/jquery-ui.min":{deps:["jquery"],exports:"jQuery"},"TYPO3/CMS/Powermail/Libraries/jquery.datetimepicker.min":{deps:["jquery","TYPO3/CMS/Powermail/Libraries/jquery.flot.min"],exports:"jQuery"},"TYPO3/CMS/Powermail/Libraries/jquery.flot.min":{deps:["jquery"],exports:"jQuery"},"TYPO3/CMS/Powermail/Libraries/jquery.flot.pie.min":{deps:["jquery","TYPO3/CMS/Powermail/Libraries/jquery.flot.min"],exports:"jQuery"},"TYPO3/CMS/Powermail/Libraries/bootstrap.min":{deps:["jquery"],exports:"jQuery"}}}),define(["jquery","TYPO3/CMS/Powermail/Libraries/jquery-ui.min","TYPO3/CMS/Powermail/Libraries/jquery.flot.min","TYPO3/CMS/Powermail/Libraries/jquery.flot.pie.min","TYPO3/CMS/Powermail/Libraries/bootstrap.min"],function(e){e(document).ready(function(e){new window.PowermailBackend(e).initialize()})});