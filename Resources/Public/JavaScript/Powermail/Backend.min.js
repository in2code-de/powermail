function PowermailBackend(r,e){"use strict";this.initialize=function(){i(),t(),n(),o(),a(),l(),s(),c(),d(),u(),f(),m(),p(),h()};var i=function(){r('*[data-action="openPowermailDetails"]').click(function(){var e=r(this),i=(e.closest("tr").find(".icon:first").toggle(),e.closest("tr").find(".openPowermailDetailsIcons .icon:last"));i.is(":visible")?i.css("display","none"):i.css("display","inline-block"),e.closest("tr").next().toggleClass("powermail_listbe_details_closed").find(".powermail_listbe_details_container").slideToggle()})},t=function(){r(document).on("click",".unhideMail, .hideMail",function(){var e=r(this),i=e.closest("td").find(".container_module_uri").val(),t=e.closest("td").find(".container_uid").val(),n=e.closest("td").find(".container_table").val(),e=v(e.closest("tr"));_(n,t,e,i)})},n=function(){r(document).on("click",'*[data-action="deleteMail"]',function(){var e=r(this),i=e.closest("td").find(".container_module_uri").val(),t=e.closest("td").find(".container_uid").val(),n=e.closest("td").find(".container_table").val(),o=e.closest("td").find(".container_label_delete_confirmation").val();confirm(o)&&(b(e.closest("tr")),w(n,t,i))})};let o=function(){document.querySelectorAll(".powermail_list .pagination a").forEach(function(e){e.addEventListener("click",function(e){e.preventDefault();var i,t=e.target.getAttribute("href").split("&");let n=0;for(let e=0;e<t.length;e++)-1!==t[e].indexOf("currentPage")&&(n=parseInt(t[e].split("=")[1]));0<n&&(e=document.querySelector("#powermail_module_search"),(i=document.createElement("input")).setAttribute("type","hidden"),i.setAttribute("name","tx_powermail_web_powermailm1[currentPage]"),i.setAttribute("value",n.toString()),e.appendChild(i),e.submit())})})};var a=function(){r("a.sorting").click(function(e){e.preventDefault();for(var i,t=r(this).prop("href").split("&"),n="",o=0;o<t.length;o++)-1!==t[o].indexOf("sorting")&&(n=t[o]);""!==n&&((e=n.split("="))[0]=e[0].replace("%40","@"),(i=r('.extended_export_sorting_container[name="'+decodeURI(e[0])+'"]')).length&&i.remove(),i='<input type="hidden" name="'+e[0]+'" value="'+e[1]+'" />',(e=r("#powermail_module_search")).append(decodeURI(i)),e.submit())})},l=function(){r(".addPowermailSelection").click(function(){C(r(this)),g()})},s=function(){r(".addPowermailSelectionAll").click(function(){r(".addPowermailSelection").each(function(){C(r(this))}),g()})},c=function(){r(".powermailSelectionDelete").click(function(){x()})},d=function(){r(".powermailSelectionHide").click(function(){y(r)})},u=function(){r("#extended_search input, #extended_search select").not('*[type="submit"]').each(function(){""!==r(this).val()&&r("#extended_search").addClass("in")})},f=function(){r(".export_icon_xls, .export_icon_csv").click(function(){if(r(this).hasClass("export_icon_xls_not_available"))return e.confirm(r(this).data("modal-title"),r(this).data("modal-text"),2,[{text:r(this).data("modal-cancel"),btnClass:"btn-default",name:"abort",trigger:function(){e.dismiss()}}]);r(this).hasClass("export_icon_csv")&&r("#forwardToAction").val("exportCsv"),r(this).hasClass("export_icon_xls")&&r("#forwardToAction").val("exportXls"),r(this).closest("form").submit()}),r('*[data-action="searchall_submit"]').click(function(){r("#forwardToAction").val("list")}),r(".extended_export_title").click(function(){var e=r(this);e.hasClass("powermail-close")?(e.removeClass("powermail-close").addClass("powermail-open").children("span").removeClass("t3-icon-move-down").addClass("t3-icon-move-up"),e.next().slideDown("",function(){e.next().children("div").children("div").fadeTo("slow",1)})):(e.removeClass("powermail-open").addClass("powermail-close").children("span").removeClass("t3-icon-move-up").addClass("t3-icon-move-down"),e.next().children("div").children("div").fadeTo("slow",0,function(){e.next().slideUp()}))}),r(function(){r(".extended_export_field, .extended_export_field_container").sortable({connectWith:".connected",update:function(e,i){var t;"export_field_selection"===r(this).prop("id")&&(t=r(this).sortable("toArray").toString(),r("#export_fields").val(t))}}).disableSelection()})},m=function(){r(".openHiddenTable").click(function(){var e=r(this).closest("tr");e.find(".dots").toggle(),e.find(".hiddenConverterTable").toggle()})},p=function(){r(".powermail_listbe_details_dd.powermail_listbe_details_type_password").html("********")},h=function(){var e=r(".powermail_reporting_form_fields_table");e.find("tr:even").addClass("even"),e.find("tr:first").removeClass("even"),e.find("tr").hide(),e.find("tr:first").show(),e.find("th").click(function(){var e=r(this);e.hasClass("powermail-close")?e.removeClass("powermail-close").addClass("powermail-open"):e.removeClass("powermail-open").addClass("powermail-close"),e.parent().siblings().slideToggle("fast")}),r('*[data-flot-active="1"]').each(function(){for(var e=r(this),i=[],t=j(e.data("flot-data-values"),","),n=j(e.data("flot-data-labels"),","),o=j(e.data("flot-data-colors"),","),a=0;a<t.length;a++){var l={data:t[a],label:n[a],color:o[a]};i.push(l)}r.plot(e,i,{series:{pie:{show:!0,innerRadius:.5,radius:1,opacity:.3,color:"#FF0000",label:{show:!0,radius:1,formatter:S,background:{opacity:.8}},combine:{color:"#999",threshold:.1}}},grid:{hoverable:!0,clickable:!0}}),e.bind("plothover",function(e,i,t){var n;t&&(n=parseFloat(t.series.percent).toFixed(2),r("#hover").html("<span style='font-weight:bold; color:"+t.series.color+"'>"+t.series.label+" ("+n+"%)</span>"))}),e.bind("plotclick",function(e,i,t){var n;t&&(n=parseFloat(t.series.percent).toFixed(2),alert(t.series.label+": "+n+"%"))})})},v=function(e){var i=e.find(".hideMail"),t=e.find(".unhideMail"),n=0;return i.hasClass("hide")?(i.removeClass("hide"),t.addClass("hide"),e.find(".powermailRecordIcon").children(":first").removeClass("hide"),e.find(".powermailRecordIcon").children(":last").addClass("hide")):(i.addClass("hide"),t.removeClass("hide"),e.find(".powermailRecordIcon").children().last().removeClass("hide"),e.find(".powermailRecordIcon").children().first().addClass("hide"),n=1),n},_=function(e,i,t,n){r.ajax({url:n+"&data["+e+"]["+i+"][hidden]="+t})},w=function(e,i,t){r.ajax({url:t+"&cmd["+e+"]["+i+"][delete]=1"})},b=function(e){e.fadeOut("slow",function(){e.next().remove(),e.remove()})},C=function(e){(e.hasClass("fa")?e.toggleClass("fa-plus").toggleClass("fa-minus"):e.toggleClass("t3-icon-view-table-expand").toggleClass("t3-icon-view-table-collapse")).closest("tr").toggleClass("selectLine")},g=function(){var e=r(".selectLine").length;r(".selectedLineMessage_numbers").html(e),0<e?r(".selectedLineMessage").show():r(".selectedLineMessage").hide()},x=function(){r(".selectLine").each(function(){var e=r(this),i=e.children(":last"),t=i.find(".container_module_uri").val(),n=i.find(".container_uid").val(),i=i.find(".container_table").val();w(i,n,t),b(e),P(e)}),g()},P=function(e){e=e.find(".addPowermailSelection");C(e)},y=function(){r(".selectLine").each(function(){var e=r(this),i=e.children(":last"),t=i.find(".container_module_uri").val(),n=i.find(".container_uid").val(),i=i.find(".container_table").val();_(i,n,v(e),t),P(e)}),g()},j=function(e,i){i=-1!==e.toString().indexOf(i)?e.split(i):[e];return i},S=function(e,i){return'<div class="flotLabel">'+e+"<br/>"+Math.round(i.percent)+"%</div>"};window.PowermailBackend=PowermailBackend}requirejs.config({map:{"*":{"jquery.flot.min":"TYPO3/CMS/Powermail/Libraries/jquery.flot.min"}},shim:{"TYPO3/CMS/Powermail/Libraries/jquery-ui.min":{deps:["jquery"],exports:"jQuery"},"TYPO3/CMS/Powermail/Libraries/jquery.datetimepicker.min":{deps:["jquery","TYPO3/CMS/Powermail/Libraries/jquery.flot.min"],exports:"jQuery"},"TYPO3/CMS/Powermail/Libraries/jquery.flot.min":{deps:["jquery"],exports:"jQuery"},"TYPO3/CMS/Powermail/Libraries/jquery.flot.pie.min":{deps:["jquery","TYPO3/CMS/Powermail/Libraries/jquery.flot.min"],exports:"jQuery"},"TYPO3/CMS/Powermail/Libraries/bootstrap.min":{deps:["jquery"],exports:"jQuery"}}}),define(["jquery","TYPO3/CMS/Backend/Modal","TYPO3/CMS/Powermail/Libraries/jquery-ui.min","TYPO3/CMS/Powermail/Libraries/jquery.flot.min","TYPO3/CMS/Powermail/Libraries/jquery.flot.pie.min","TYPO3/CMS/Powermail/Libraries/bootstrap.min"],function(e,i){e(document).ready(function(e){new window.PowermailBackend(e,i).initialize()})});